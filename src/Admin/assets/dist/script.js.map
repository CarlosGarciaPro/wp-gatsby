{"version":3,"sources":["../src/script.js"],"names":["updateLoaderWarning","message","previewWarningP","document","getElementById","innerHTML","style","display","cancelPreviewLoader","showError","fetchPreviewStatusAndUpdateUI","ignoreNoIndicationOfSourcing","fetch","initialState","previewFrontendUrl","method","body","JSON","stringify","nodeId","modified","headers","then","response","json","onPreviewReady","catch","errorMessage","str_post","displayNoIndicationOfSourcingWarningAndTryAgain","noIndicationOfSourcingWarningTimeout","setTimeout","timeoutMilliseconds","clearTimeout","timeoutWarning","type","Error","console","log","payload","pageNode","path","previewIframe","addEventListener","onIframeLoaded","src","loader","classList","add","timeoutSeconds","e","error","iframe","errorElement","textContent","content","querySelector"],"mappings":"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","sourcesContent":["/**\n * This file is printed out in preview-template.php\n * initialState global comes from preview-template.php above where this is printed to the page\n */\ntry {\n\tfunction updateLoaderWarning(message) {\n\t\tconst previewWarningP = document.getElementById(\"preview-loader-warning\")\n\n\t\tpreviewWarningP.innerHTML = `${message}<br /><br /><button onclick=\"cancelPreviewLoader()\">Cancel and Troubleshoot</button>`\n\t\tpreviewWarningP.style.display = \"initial\"\n\t}\n\n\tconst timeoutSeconds = 45\n\tconst timeoutMilliseconds = 1000 * timeoutSeconds\n\n\tconst timeoutWarning = setTimeout(() => {\n\t\tupdateLoaderWarning(\n\t\t\t`Preview is taking a very long time to load (more than ${timeoutSeconds} seconds).<br />Try pressing \"preview\" again from the WordPress edit screen.<br />If you see this again, your preview builds are either slow or there's something wrong.`,\n\t\t)\n\t}, timeoutMilliseconds)\n\n\tfunction cancelPreviewLoader() {\n\t\tshowError(`Preview was cancelled.`)\n\t}\n\n\tfunction fetchPreviewStatusAndUpdateUI({\n\t\tignoreNoIndicationOfSourcing = false,\n\t} = {}) {\n\t\tfetch(initialState.previewFrontendUrl + `/__wpgatsby-preview-status`, {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify({\n\t\t\t\tnodeId: initialState.nodeId,\n\t\t\t\tmodified: initialState.modified,\n\t\t\t\tignoreNoIndicationOfSourcing,\n\t\t\t}),\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t})\n\t\t\t.then((response) => response.json())\n\t\t\t.then((response) => {\n\t\t\t\tonPreviewReady(response)\n\t\t\t})\n\t\t\t.catch((errorMessage) => {\n\t\t\t\tif (\n\t\t\t\t\ttypeof errorMessage === `string` &&\n\t\t\t\t\terrorMessage.str_post(`Unexpected token < in JSON at position 0`)\n\t\t\t\t) {\n\t\t\t\t\terrorMessage += `\\n\\nYour version of gatsby-source-wordpress-experimental is likely out of date.\\n\\nPlease upgrade to the latest version.`\n\t\t\t\t}\n\t\t\t\tshowError(errorMessage)\n\t\t\t})\n\t}\n\n\tfetchPreviewStatusAndUpdateUI()\n\n\tlet noIndicationOfSourcingWarningTimeout\n\n\tfunction displayNoIndicationOfSourcingWarningAndTryAgain() {\n\t\tnoIndicationOfSourcingWarningTimeout = setTimeout(() => {\n\t\t\tupdateLoaderWarning(\n\t\t\t\t`There is no indication that preview data is being sourced by the server.<br /><br />A code change for this website might be deploying and blocking preview from working.<br /><br /><b>Please try pressing \"preview\" in WordPress again.</b><br />If you see this message again, wait 5 - 10 minutes and then try again,<br />or contact your developer for help.`,\n\t\t\t)\n\t\t}, timeoutMilliseconds)\n\n\t\tfetchPreviewStatusAndUpdateUI({ ignoreNoIndicationOfSourcing: true })\n\t}\n\n\tfunction onPreviewReady(response) {\n\t\tclearTimeout(timeoutWarning)\n\n\t\tif (response.type && response.type === `NOT_IN_PREVIEW_MODE`) {\n\t\t\tthrow new Error(\n\t\t\t\t`Your Gatsby site is not in Preview mode.\\nIf you're hosting on Gatsby Cloud, please see below for where to contact support.\\nIf you're running Previews locally or are self-hosting, please refer to https://www.gatsbyjs.com/docs/refreshing-content to put Gatsby into Preview mode.`,\n\t\t\t)\n\t\t}\n\n\t\tif (response.type && response.type === `NO_INDICATION_OF_SOURCING`) {\n\t\t\treturn displayNoIndicationOfSourcingWarningAndTryAgain()\n\t\t}\n\n\t\tconsole.log(`Received a response:`)\n\t\tconsole.log(response)\n\n\t\tif (\n\t\t\t!response.type ||\n\t\t\t!response.payload ||\n\t\t\t!response.payload.pageNode ||\n\t\t\t!response.payload.pageNode.path\n\t\t) {\n\t\t\tthrow new Error(`Received an improper response from the Preview server.`)\n\t\t}\n\n\t\tconst previewIframe = document.getElementById(\"preview\")\n\n\t\tpreviewIframe.addEventListener(\"load\", onIframeLoaded)\n\n\t\tpreviewIframe.src =\n\t\t\tinitialState.previewFrontendUrl + response.payload.pageNode.path\n\n\t\tif (!noIndicationOfSourcingWarningTimeout) {\n\t\t\tclearTimeout(noIndicationOfSourcingWarningTimeout)\n\t\t}\n\t}\n\n\tfunction onIframeLoaded() {\n\t\tconst loader = document.getElementById(\"loader\")\n\n\t\t// this delay prevents a flash between\n\t\t// the iframe painting and the loader dissapearing\n\t\tsetTimeout(() => {\n\t\t\t// there is a fadeout css animation on this\n\t\t\tloader.classList.add(\"loaded\")\n\n\t\t\tsetTimeout(() => {\n\t\t\t\t// we wait a sec to display none so the css animation fadeout can complete\n\t\t\t\tloader.style.display = \"none\"\n\t\t\t}, 100)\n\t\t}, 50)\n\t}\n} catch (e) {\n\tdocument.addEventListener(\"DOMContentLoaded\", () => {\n\t\tshowError(e)\n\t})\n}\n\nfunction showError(error) {\n\tconst iframe = document.getElementById(\"preview\")\n\tiframe.style.display = \"none\"\n\n\tconst loader = document.getElementById(\"loader\")\n\tloader.style.display = \"none\"\n\n\tconst errorElement = document.getElementById(\"error-message-element\")\n\terrorElement.textContent = error\n\n\tconst content = document.querySelector(\".content.error\")\n\tcontent.style.display = \"block\"\n}\n"],"file":"script.js"}